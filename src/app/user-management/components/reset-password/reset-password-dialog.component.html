<div class="reset-password-dialog" [class.theme-light]="currentTheme === 'light'" [class.theme-dark]="currentTheme === 'dark'">
  <div class="dialog-header" [class.animated-bg-light]="currentTheme === 'light'" [class.animated-bg-dark]="currentTheme === 'dark'">
    <h2 mat-dialog-title>
      <mat-icon>lock_reset</mat-icon>
      Reset Password
    </h2>
    <button mat-icon-button (click)="onCancel()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <!-- User Account Info -->
    <div class="user-info-section">
      <mat-card class="user-info-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>person</mat-icon>
          <mat-card-title>{{ data.user?.name || 'User' }} {{ data.user?.surname || '' }}</mat-card-title>
          <mat-card-subtitle>{{ data.user?.role || 'Unknown Role' }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="user-details">
            <div class="detail-item">
              <mat-icon>account_circle</mat-icon>
              <span class="label">Username:</span>
              <span class="value">{{ data.user?.username || 'N/A' }}</span>
            </div>
            <div class="detail-item" *ngIf="data.user?.email">
              <mat-icon>email</mat-icon>
              <span class="label">Email:</span>
              <span class="value">{{ data.user.email }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Password Reset Options -->
    <mat-tab-group class="password-tabs">
      <!-- Generate Password Tab -->
      <mat-tab label="Generate Password">
        <div class="tab-content">
          <div class="generate-section">
            <mat-icon class="section-icon">auto_fix_high</mat-icon>
            <h3>System Generated Password</h3>
            <p class="description">
              Let the system generate a secure password that you can copy and share with the user.
            </p>
            
            <button 
              mat-raised-button 
              color="primary" 
              (click)="onGeneratePassword()" 
              [disabled]="loading"
              class="generate-btn">
              <mat-icon *ngIf="!loading">refresh</mat-icon>
              <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
              {{ loading ? 'Generating...' : 'Generate Password' }}
            </button>

            <!-- Generated Password Display -->
            <div *ngIf="generatedPassword" class="generated-password-section">
              <mat-card class="password-card">
                <mat-card-header>
                  <mat-icon mat-card-avatar>vpn_key</mat-icon>
                  <mat-card-title>Generated Password</mat-card-title>
                  <mat-card-subtitle>Copy and share this password securely</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="password-display">
                    <mat-form-field appearance="outline" class="password-field">
                      <mat-label>New Password</mat-label>
                      <input matInput [value]="generatedPassword" readonly>
                      <mat-icon matSuffix>lock</mat-icon>
                    </mat-form-field>
                    <button 
                      mat-icon-button 
                      (click)="onCopyPassword()" 
                      class="copy-btn"
                      matTooltip="Copy to clipboard">
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>
                  <div class="password-actions">
                    <button mat-button (click)="onCopyPassword()" class="copy-button">
                      <mat-icon>content_copy</mat-icon>
                      Copy Password
                    </button>
                    <button mat-button (click)="onGeneratePassword()" class="regenerate-button">
                      <mat-icon>refresh</mat-icon>
                      Generate New
                    </button>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
        </div>
      </mat-tab>

      <!-- Manual Password Tab -->
      <mat-tab label="Set Custom Password">
        <div class="tab-content">
          <div class="manual-section">
            <mat-icon class="section-icon">edit</mat-icon>
            <h3>Custom Password</h3>
            <p class="description">
              Set a specific password that the user can use to log in.
            </p>

            <form [formGroup]="manualPasswordForm" class="password-form">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>New Password *</mat-label>
                <input 
                  matInput 
                  [type]="passwordVisible ? 'text' : 'password'"
                  formControlName="newPassword" 
                  placeholder="Enter new password">
                <mat-icon matSuffix (click)="togglePasswordVisibility()" class="visibility-toggle">
                  {{ passwordVisible ? 'visibility_off' : 'visibility' }}
                </mat-icon>
                <mat-error *ngIf="getFieldError('newPassword')">{{ getFieldError('newPassword') }}</mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Confirm Password *</mat-label>
                <input 
                  matInput 
                  [type]="confirmPasswordVisible ? 'text' : 'password'"
                  formControlName="confirmPassword" 
                  placeholder="Confirm new password">
                <mat-icon matSuffix (click)="toggleConfirmPasswordVisibility()" class="visibility-toggle">
                  {{ confirmPasswordVisible ? 'visibility_off' : 'visibility' }}
                </mat-icon>
                <mat-error *ngIf="getFieldError('confirmPassword')">{{ getFieldError('confirmPassword') }}</mat-error>
              </mat-form-field>

              <!-- Password Requirements -->
              <div class="password-requirements">
                <h4>Password Requirements:</h4>
                <ul>
                  <li>At least 8 characters long</li>
                  <li>Contains uppercase letter (A-Z)</li>
                  <li>Contains lowercase letter (a-z)</li>
                  <li>Contains number (0-9)</li>
                  <li>Contains special character (!@#$%^&*)</li>
                </ul>
              </div>

              <button 
                mat-raised-button 
                color="primary" 
                (click)="onSetManualPassword()" 
                [disabled]="manualPasswordForm.invalid || loading"
                class="set-password-btn">
                <mat-icon *ngIf="!loading">save</mat-icon>
                <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
                {{ loading ? 'Setting Password...' : 'Set Password' }}
              </button>
            </form>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions">
    <button mat-button (click)="onCancel()" class="cancel-button">
      <mat-icon>cancel</mat-icon>
      Cancel
    </button>
  </mat-dialog-actions>
</div>
